<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v9.0.3 <https://hydejack.com/>
-->
















<head>
  






  
    
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>PIC16B Final Project Reflection | Michael Ting</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="PIC16B Final Project Reflection" />
<meta name="author" content="Michael Ting" />
<meta property="og:locale" content="en" />
<meta name="description" content="Thoughts on our PIC 16B final project: MoodSpace" />
<meta property="og:description" content="Thoughts on our PIC 16B final project: MoodSpace" />
<link rel="canonical" href="http://gmarini.com/blog/blog/programming/pic16b/2021-06-05-pic16b-reflection/" />
<meta property="og:url" content="http://gmarini.com/blog/blog/programming/pic16b/2021-06-05-pic16b-reflection/" />
<meta property="og:site_name" content="Michael Ting" />
<meta property="og:image" content="http://gmarini.com/assets/img/projects/moodspace_thumbnail.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-05T00:00:00-07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://gmarini.com/assets/img/projects/moodspace_thumbnail.png" />
<meta property="twitter:title" content="PIC16B Final Project Reflection" />
<meta name="twitter:site" content="@qwtel" />
<meta name="twitter:creator" content="@Michael Ting" />
<meta name="google-site-verification" content="kRoh_csFULhK6lxBJwZOxiWYQpvttOkFj0a3lWwQADc" />
<script type="application/ld+json">
{"headline":"PIC16B Final Project Reflection","dateModified":"2021-06-14T12:33:36-07:00","datePublished":"2021-06-05T00:00:00-07:00","@type":"BlogPosting","image":"http://gmarini.com/assets/img/projects/moodspace_thumbnail.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://gmarini.com/blog/blog/programming/pic16b/2021-06-05-pic16b-reflection/"},"url":"http://gmarini.com/blog/blog/programming/pic16b/2021-06-05-pic16b-reflection/","author":{"@type":"Person","name":"Michael Ting"},"description":"Thoughts on our PIC 16B final project: MoodSpace","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://gmarini.com/assets/icons/icon.jpg"},"name":"Michael Ting"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  

  
    <meta name="keywords" content="PhD,coding,programming,android,IoT,Ubiquitous,computing,computer,science">
  

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Michael Ting">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="application-name" content="Michael Ting">


  <meta name="theme-color" content="rgb(8,46,57)">


<meta name="generator" content="Hydejack v9.0.3" />


<link rel="alternate" href="http://gmarini.com/blog/blog/programming/2020-05-27-ok-zoomer/" hreflang="en">

<link type="application/atom+xml" rel="alternate" href="http://gmarini.com/feed.xml" title="Michael Ting" />


<link rel="shortcut icon"    href="/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">

<link rel="manifest" href="/assets/site.webmanifest">


  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">



  <link rel="dns-prefetch" href="https://www.google-analytics.com">


<link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG">

<link rel="dns-prefetch" href="/assets/js/search-worker-9.0.3.js" as="worker" id="_hrefSearch">

  
  <link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_katexPreload">




<link rel="dns-prefetch" href="https://mting314-com.disqus.com" id="_hrefDisqus">


<script>!function(e,t){"use strict";function n(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}e.loadJS=function(e,o){var r=t.createElement("script");r.src=e,o&&n(r,"load",o,{once:!0});var a=t.scripts[0];return a.parentNode.insertBefore(r,a),r},e._loaded=!1,e.loadJSDeferred=function(o,r){function a(){e._loaded=!0,r&&n(c,"load",r,{once:!0});var o=t.scripts[0];o.parentNode.insertBefore(c,o)}var c=t.createElement("script");return c.src=o,e._loaded?a():n(e,"load",a,{once:!0}),c},e.setRel=e.setRelStylesheet=function(e){function o(){this.rel="stylesheet"}n(t.getElementById(e),"load",o,{once:!0})}}(window,document);
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
!function(w) {
  w._baseURL = '/';
  w._publicPath = '/assets/js/';
  w._noPushState = false;
  w._noDrawer = false;
  w._noNavbar = false;
  w._noToc = false;
  w._noSearch = false;
}(window);
</script>



<!--[if gt IE 8]><!---->

  




<link rel="stylesheet" href="/assets/css/hydejack-9.0.3.css" id="_stylePreload">
<link rel="stylesheet" href="/assets/icomoon/style.css" id="_iconsPreload">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload">



  <style id="_pageStyle">

html{--accent-color: rgb(79,177,186);--accent-color-transparent:  rgba(79,177,186,0.5);--accent-color-transparent-darkened:  rgba(32,76,80,0.8);--accent-color-faded: rgba(79,177,186,0.5);--accent-color-darkened: #409ba3;--theme-color: rgb(8,46,57);--dark-mode-body-bg: #282f31;--dark-mode-border-color: #343d3f}

</style>


<!--<![endif]-->


<!--
Code used for embedding Gumroad on the Hydejack Site. 
Left here for reference, feel free to delete.
-->



<!-- It's better to but it here as it is loaded BEFORE my-scripts.html -->
<script src="/assets/mting314/js/jquery-3.5.1.min.js"></script>



<link rel="dns-prefetch" href="https://assets.gumroad.com">
<script type="module">
  const ppiData = window._ppiData = fetch('https://hydejack-ppi.qwtel.workers.dev', { mode: 'cors'}).then(res => res.json()).catch(() => ({}));
  const promisify = f => x => new Promise(r => f(x).addEventListener('load', r));
  const loadJS = promisify(window.loadJS);
  {
    let p;
    document.querySelector('hy-push-state').addEventListener('load', () => {
      const io = new IntersectionObserver(async (entries) => {
        if (entries.some(x => x.isIntersecting)) {
          p = p || loadJS('https://gumroad.com/js/gumroad-embed.js');
          const [{ code }] = await Promise.all([ppiData, p]);
          document.querySelectorAll('.gumroad-product-embed').forEach(el => { 
            if (!el.dataset.gumroadParams) {
              el.dataset.gumroadParams = 'offer_code=' + (code || 'qr0tw8m');
            }
          });
          if (!window.GumroadEmbed) {
            await new Promise(function check1(res) {
              if ('createGumroadEmbed' in window) res(window.createGumroadEmbed());
              else setTimeout(() => check1(res), 200);
            });
          }
          await new Promise(function check2(res) {
            if ('GumroadEmbed' in window) res(GumroadEmbed.reload());
            else setTimeout(() => check2(res), 200);
          });
        }
      }, { rootMargin: '1440px' });
      document.querySelectorAll('.gumroad-product-embed').forEach(el => io.observe(el));
    });
  }
  {
    let p;
    document.querySelector('hy-push-state').addEventListener('load', () => {
      const io = new IntersectionObserver(async (entries) => {
        if (entries.some(x => x.isIntersecting)) {
          p = p || loadJS('https://gumroad.com/js/gumroad.js');
          const [{ code }] = await Promise.all([ppiData, p]);
          if (code) {
            document.querySelectorAll('.gumroad-button').forEach(el => { 
              if (!el.href.endsWith(code)) {
                el.href = el.href + '/' + (code || 'qr0tw8m');
              }
            });
          }
          if (!window.GumroadOverlay) {
            await new Promise(function check(res) {
              if ('createGumroadOverlay' in window) res(window.createGumroadOverlay());
              else setTimeout(() => check(res), 200);
            });
          }
        }
      }, { rootMargin: '300px' });
      document.querySelectorAll('.gumroad-button').forEach(el => io.observe(el));
    });
  }
</script>

</head>

<body class="no-break-layout no-large-headings">
  
<script>
  window._sunrise = 9;
  window._sunset =  18;
  window.match_os =  false;
  !function (window, document) {
  var LM = 'light-mode';
  var DM = 'dark-mode';
  var h = new Date().getHours();
  document.body.classList.add(DM); /*Start in dark mode and eventually switch */
  console.log("match_os " + match_os + " time " +h);
  /* if match_os is false, the time has the preference on deciding  which mode */
  if (window.match_os  && 'matchMedia' in window && window.matchMedia('(prefers-color-scheme)')) return;
  var m = h <= window._sunrise || h >= window._sunset  ? DM : LM; 
  var n = m === DM ? LM : DM;
  document.body.classList.add(m);
  document.body.classList.remove(n);
}(window, document);

</script>



<hy-push-state
  id="_pushState"
  replace-selector="#_main"
  link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)"
  script-selector="script"
  duration="500"
  hashchange
>
  
  <div id="_navbar" class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <div class="nav-btn-bar">
      <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
      <div class="nav-span"></div>
    </div>
  </div>
</div>
<hr class="sr-only" hidden />

  <main
  id="_main"
  class="content layout-post"
  role="main"
>
  





<article id="post-blog-blog-programming-pic16b-pic16b-reflection" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      
        PIC16B Final Project Reflection

      
    </h1>

    <div class="post-date">
      
        
        <time datetime="2021-06-05T00:00:00-07:00">05 Jun 2021</time>
      
      
      
      
      
      









in <a href="/blog/blog/" class="flip-title">Blog</a> / <a href="/blog/programming/" class="flip-title">Programming</a> / <span>Pic16b</span>

      











    </div>

    
    
      
        
        
          <div class="lead aspect-ratio sixteen-nine flip-project-img">
            





<img
  
    src="/assets/img/projects/moodspace_thumbnail.png"
    
    
  
  alt="PIC16B Final Project Reflection"
  
  
  width="864"
  height="486"
  loading="lazy"
/>

          
        </div>
      
      
    

    



  
    <p class="note-sm"   >
      Thoughts on our PIC 16B final project: MoodSpace

    </p>
  


  </header>

  
    <ul id="markdown-toc">
  <li><a href="#what-did-i-learn" id="markdown-toc-what-did-i-learn">What did I learn?</a>    <ul>
      <li><a href="#working-on-projects-that-arent-my-own" id="markdown-toc-working-on-projects-that-arent-my-own">Working on projects that aren’t my own</a></li>
      <li><a href="#working-in-a-team" id="markdown-toc-working-in-a-team">Working in a team</a></li>
      <li><a href="#technologies" id="markdown-toc-technologies">Technologies</a></li>
      <li><a href="#people-oriented-collaboration" id="markdown-toc-people-oriented-collaboration">“People-oriented” Collaboration</a></li>
    </ul>
  </li>
  <li><a href="#the-big-problem" id="markdown-toc-the-big-problem">The Big Problem™</a></li>
  <li><a href="#how-the-algorithm-works" id="markdown-toc-how-the-algorithm-works">How the Algorithm works</a>    <ul>
      <li><a href="#model-details" id="markdown-toc-model-details">Model Details</a>        <ul>
          <li><a href="#embedding-layer" id="markdown-toc-embedding-layer">Embedding Layer</a></li>
          <li><a href="#dropout-layer" id="markdown-toc-dropout-layer">Dropout Layer</a></li>
        </ul>
      </li>
      <li><a href="#model-training" id="markdown-toc-model-training">Model Training</a></li>
      <li><a href="#finding-song-matches" id="markdown-toc-finding-song-matches">Finding Song Matches</a></li>
    </ul>
  </li>
  <li><a href="#what-could-have-gone-better" id="markdown-toc-what-could-have-gone-better">What could have gone better</a></li>
  <li><a href="#going-forward" id="markdown-toc-going-forward">Going forward</a></li>
  <li><a href="#concluding-thoughts" id="markdown-toc-concluding-thoughts">Concluding thoughts</a></li>
</ul>

<p>This Spring quarter, I had the opportunity to participate in a brand new (almost experimental) course at UCLA: PIC 16B. Being a more “topics”-oriented course, our final ended up being a project, where we were instructed to make groups and just make something fun, so long as it focused on data or machine learning.</p>

<p>Our group came up with MoodSpace, a sort of “movie soundtrack generator”. Utilizing <strong><a href="https://spotipy.readthedocs.io/en/2.18.0/">Spotipy</a></strong>, and what we’ve learned about <strong>TensorFlow+neural networks</strong>, and some <strong>SQLAlchemy</strong> we learned on the way for the backend, we built a machine learning model that upon select one of our curated famous movie scenes (think the throne room scene from The Last Jedi, or the ending of Titanic), could come up with a playlist of songs that fit it. We then deployed it to AWS, and built a front-end python Flask application to serve recommendation interface.</p>

<p>Ok, so enough about the bland details about the project itself, let’s start talking about how I <em>feel</em> about it.
<!-- 
How did it start? The funny story is that I was actually on a little "getaway" with my family at the very start of the quarter when we were supposed to form project groups. Our professor organized some time for everyone to mingle and decide who to work with, but I almost forgot during this time and  --></p>

<h2 id="what-did-i-learn">What did I learn?</h2>

<h3 id="working-on-projects-that-arent-my-own">Working on projects that aren’t my own</h3>

<p>I’ll be honest, right from the beginning, I felt myself biting my tongue a little bit when our group decided this would be our topic. I remember thinking “oh, pfft, I don’t really care about movies and songs and stuff, this is going to be kind of boring”. Now that I think about it, I’m realizing that this is the first long-term and decently technical project I’ve worked on with peers ever really. I think I’ve gotten so my own projects where of course being the sole developer means that I’m 100% invested, but in this situation, of course that was pretty far from the truth.</p>

<p>Maybe that’s a lesson in and of itself, though - maybe there is something valuable in the experience of “oh, even though I don’t really care about this big idea, I still want to find a good way to contribute”.</p>

<p>And honestly, I’m glad I went through that, because at the end of the day, what happened? I did actually find myself quite invested in the project and realizing that the idea was pretty fun. More and more as the project went on, I started becoming more and more invested in trying to contribute in my own way to make a good, working product. As I’ve mentioned, I’ve not put myself in a position where there’s many opportunities to do that in the past. But now, in a really nice way, pushing myself to work on the project really did help me be a bit more open-minded to say “hey, even if I’m not into this stuff doesn’t mean it won’t be interesting or fun to work on.”</p>

<h3 id="working-in-a-team">Working in a team</h3>

<p>Maybe more abstractly, I do continue to learn more about how I work in a team as well, particularly in school-based technical projects. In particular, this project has solidified for me that I have this strong tendency to just forge on ahead on my own and do a bunch of programming on my own. Maybe its because I have a desire to prove myself as a fast/competent programmer to my teammates, or maybe its just because I work best during degenerate hours of the night, or maybe its just plain social anxiety - whatever it is, this project has indeed just made it clear to me that its probably something to think about.</p>

<p>Not that this is a 100% bad thing though. In this project, one really interesting and almost defining characteristic of our team was that we all <em>really</em> naturally fell into separate niches within the overall product, and I believe it made the experience much more fun. We had one person who really loves graphic design come up with pretty much all the CSS and interactivity, and holy moly she really popped off. I mean, have you seen the site? And our third teammate was the one who pretty much came up with all the machine learning stuff. I’ll go into the detail, but he was really clever with the way he related the movies and songs in a way I would have never been able to see myself. Either way, we all have a component of the end product we’re all really proud of.</p>

<h3 id="technologies">Technologies</h3>

<p>Anyway, in particular, I found myself working really hard “lone-wolfing” learning and implementing <strong>Postgres + SQLAlchemy</strong> for the main database backend simply because I trusted my own judgement that this would not solve an annoyance, but also serve to make the app quite a bit more “professional” in my opinion (whatever that means) through a technology that I actually quite enjoyed learning about. (SQLAlchemy is actually pretty magical, I wish it was one of the topic our class covered haha).</p>

<p>Of course, this system did run into many many bumps though, but there wasn’t anything we hadn’t sorted out. The biggest annoyance by far we had in the development process was the age-old DevOps problem I’m all too used to by now from my “computer scienc-y” internships: getting everything working on everyone’s local machines. Now if we were in a more computer scienc-y class, we’d probably just all install <a href="https://www.docker.com/">Docker</a> and call it a day, but honestly that would be more trouble than its would be worth for my teammates. Instead, were able to get around the issues using lots and lots of really nice Git features. Of course, from the previous internships I know how to use most of that stuff (branching, pull requests and merging), but it was nice to finally be the one actually benefitting from all the organization we were putting in. With multiple branches, I was able to work on my branch where I’d set up the backend database, and my teammates could work on machine learning + frontend on the branch where you didn’t have to bother install the slightly hefty Postgres source, and then yet another “deployment” branch that actually made it to Heroku. It felt satisfying being able to orchestrate communication and coding among all of the branches all of that as a team, and all of this was basically thanks to what we learned in Git, and the awesome communication we had as teammates.</p>

<h3 id="people-oriented-collaboration">“People-oriented” Collaboration</h3>

<p>Speaking of my teammates though, I am extremely glad we ended up being a group together. Let’s just say they aren’t the types of people I normally hang out with, but this project gave us a good common ground to talk about and I’m even glad to say I may be one of the lucky few to come out of the pandemic with a little net gain in number of friends. Earlier, when our professor actually gave a little talk to the undergrad math club here at UCLA, he emphasized that research that’s more “people-oriented”, rather than “topic-oriented” was actually a perfectly valid route to go that that he himself had been really enjoying. Perhaps he didn’t have the exact Gen Z vocabulary to describe it, but the overall group “vibe”, especially for a class like this where to be honest the journey probably is a lot more imporant than the destination.</p>

<h2 id="the-big-problem">The Big Problem™</h2>

<p>Now I want to dive deep into a little adventure we had into the biggest problem with our project as a whole. We had gotten to a point where we set up an initial stab at a machine learning pipeline:</p>
<ol>
  <li>Perform k-means clustering on a baseline set of songs</li>
  <li>Build and train the machine learning model using our created clusters as targets</li>
  <li>Use the same model on the movie scripts</li>
  <li>Find closest song</li>
</ol>

<p>We thought this was originally a clever way to marry together the “feeling” of two kinds of data: movies and songs. We didn’t think too much of this for a while, though, because we ended up being more focused on making the actual website and interface work for a while.</p>

<p>However, once we finished that, unfortunately quite late into the project, we started experimenting with the actual recommendations, and soon realized the Big Problem™:</p>

<blockquote>
  <p>Many very different movie scenes were recommending the same songs over and over again.</p>
</blockquote>

<p>We spent so much time of the project on getting a functional pipeline and having a nice user interface that the actual thinking and effort on the model was quite lacking until the very end of the project. However, when we finally started noticing this, it took us quite a long time to figure out exactly why this was happening.</p>

<p>After quite a bit of experimenting, we finally figured out there to look. We eventually got around to making a notebook that diagnosed the problem in a nice quantitative way, but here’s the long and the short of it: all the movies ended up being very super duper close in feature space!</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bourne.txt [  0.8028168    0.54838055 108.58993      0.13968945]
deadpoets.txt [  0.91196984   0.58987993 151.97827      0.16713756]
fellowship.txt [ 0.73340935  0.5333094  89.36578     0.13055968]
forrest.txt [  0.8148412    0.5624935  116.31569      0.13917923]
goodwillhunting.txt [  0.8513357    0.5705814  132.71431      0.16935092]
incredibles.txt [  0.81596416   0.5668687  122.77204      0.13890487]
jedi.txt [  0.7981779    0.5339753  110.80746      0.15427852]
khan.txt [  0.8221025    0.5758075  130.59529      0.14089489]
shawshank.txt [  0.81988424   0.5672764  121.83119      0.14175367]
titanic.txt [  0.8225643    0.5699205  123.32264      0.14206994]
</code></pre></div></div>

<p>Because of this, we noticed the exact same songs that were close to this “cluster” of movies in feature space were the only ones being picked, because we were just picking the songs with lowest distance to these movies in feature space.</p>

<p>Ok, so we know the issue. But at this point we became a bit stumped. The model was being trained on the song lyrics and we couldn’t really change those. We tried improving our layers upping the number of dimensions in the embedding layer or changing the activation functions. This helped the model accuracy when predicting the clusters that the songs belonged to, but this didn’t really move the needle as far as the movie predictions were concerned, so we still had this issue of movies being too close.</p>

<p>Again, after quite a bit of experimenting, we came up with an idea that worked. Instead of trying to target these arbitrary clusters that we got from a completely separate pipeline that probably wasn’t translating well when we ran the model on the movie scripts, we actually trained the model using some additional statistics we had thrown to the wayside a bit ago: Spotify metrics.</p>

<p>Here’s how it worked.</p>

<h2 id="how-the-algorithm-works">How the Algorithm works</h2>

<blockquote>
  <p>Credit for this part goes to <a href="https://github.com/benbrill">Ben Brill</a>, our Main Machine Learning Person</p>
</blockquote>

<p>Spotify has several different metrics it measures for each song on it’s API. For instance, if we wanted to see the statistics for the song “Waiting on the World to Change” by John Mayer, we find the following:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[{</span><span class="s">'danceability'</span><span class="p">:</span> <span class="mf">0.514</span><span class="p">,</span>
  <span class="s">'energy'</span><span class="p">:</span> <span class="mf">0.73</span><span class="p">,</span>
  <span class="s">'key'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s">'loudness'</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.934</span><span class="p">,</span>
  <span class="s">'mode'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s">'speechiness'</span><span class="p">:</span> <span class="mf">0.0598</span><span class="p">,</span>
  <span class="s">'acousticness'</span><span class="p">:</span> <span class="mf">0.00146</span><span class="p">,</span>
  <span class="s">'instrumentalness'</span><span class="p">:</span> <span class="mf">9.54e-05</span><span class="p">,</span>
  <span class="s">'liveness'</span><span class="p">:</span> <span class="mf">0.0897</span><span class="p">,</span>
  <span class="s">'valence'</span><span class="p">:</span> <span class="mf">0.334</span><span class="p">,</span>
  <span class="s">'tempo'</span><span class="p">:</span> <span class="mf">171.005</span><span class="p">,</span>
  <span class="s">'type'</span><span class="p">:</span> <span class="s">'audio_features'</span><span class="p">,</span>
  <span class="s">'id'</span><span class="p">:</span> <span class="s">'0VjIjW4GlUZAMYd2vXMi3b'</span><span class="p">,</span>
  <span class="s">'uri'</span><span class="p">:</span> <span class="s">'spotify:track:0VjIjW4GlUZAMYd2vXMi3b'</span><span class="p">,</span>
  <span class="s">'track_href'</span><span class="p">:</span> <span class="s">'https://api.spotify.com/v1/tracks/0VjIjW4GlUZAMYd2vXMi3b'</span><span class="p">,</span>
  <span class="s">'analysis_url'</span><span class="p">:</span> <span class="s">'https://api.spotify.com/v1/audio-analysis/0VjIjW4GlUZAMYd2vXMi3b'</span><span class="p">,</span>
  <span class="s">'duration_ms'</span><span class="p">:</span> <span class="mi">200040</span><span class="p">,</span>
  <span class="s">'time_signature'</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]</span>
</code></pre></div></div>
<p>However, movie scenes obviously do not have these same metrics, because they do not have any musicality that can be measured, only dialogue. To bridge the gap between movie and song, we must provide to a model some sort of medium that both movie and songs share. Luckily, both have some form of text. For songs, it is the lyrics, and for movies it is the screenplay text.</p>

<p>With this in mind, we can now develop an idea of what the inputs and outputs of our model should be. The input of our model should be some sort of text, whether that be lyrics or screenplay. The output should be a given set of Spotify metrics. We can train our model using song lyrics as input variables and their respective Spotify Metrics as target variables. From there, we can apply this model to given screenplays to predict what the Spotify metrics <em>would</em> be given the text composition of that scene. Now that we have metrics for both songs and screenplays, we can compare the two to see which songs are most alligned to a selected scene’s screenplay.</p>

<h3 id="model-details">Model Details</h3>

<p>We implemented the above model infastructure using a <code class="language-text highlighter-rouge">tensorflow.keras</code> neural network. Prior to actually inputing the text into the model, it must be vectorized, using the tensorflow <code class="language-text highlighter-rouge">TextVectorization</code> function, which returns a vector that represents the words contained within a given song or screenplay in a tokenized form. Once this is complete, we can feed this tokenized vector into our neural network. An outline of our model’s structure is shown below.</p>

<p><img src="assets/img/blog/moodspace_files/model_arch.png" alt="A depection of our neural network's structure" /></p>

<p>Let’s highlight a couple of key features of this model.</p>

<h4 id="embedding-layer">Embedding Layer</h4>
<p>The embedding layer takes an input of a vector representing a tokenized string and converts it into a vector in <code class="language-text highlighter-rouge">n</code> dimensional space. We chose <code class="language-text highlighter-rouge">n = 60</code>. This enables our model to visualize where each of our texts might lie in this space, and thus determine connections and patteawfawfrns between them to output to subsequent layers of our model.</p>

<h4 id="dropout-layer">Dropout Layer</h4>
<p>These layers are placed at various locations in the model to “dropout” some of the connecting neurons within the network, to prevent overfitting.</p>

<h3 id="model-training">Model Training</h3>

<p>We trained our model on a random set of songs in the Spotify API who had English lyrics on Genuis API. The target was set as the Spotify Metrics <code class="language-text highlighter-rouge">energy</code>, <code class="language-text highlighter-rouge">valence</code>, <code class="language-text highlighter-rouge">tempo</code>, and <code class="language-text highlighter-rouge">liveness</code>. These were the results of our final epochs in fitting the model.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Epoch 96/100
20/20 [==============================] - 4s 220ms/step - loss: 2.9242 - root_mean_squared_error: 7.9613 - msle: 0.0210 - val_loss: 5.9375 - val_root_mean_squared_error: 15.3059 - val_msle: 0.0325
Epoch 97/100
20/20 [==============================] - 4s 220ms/step - loss: 2.9864 - root_mean_squared_error: 8.0015 - msle: 0.0205 - val_loss: 6.0919 - val_root_mean_squared_error: 15.4481 - val_msle: 0.0317
Epoch 98/100
20/20 [==============================] - 6s 281ms/step - loss: 3.0456 - root_mean_squared_error: 8.0510 - msle: 0.0215 - val_loss: 6.1032 - val_root_mean_squared_error: 15.4863 - val_msle: 0.0328
Epoch 99/100
20/20 [==============================] - 5s 257ms/step - loss: 3.1289 - root_mean_squared_error: 8.1052 - msle: 0.0218 - val_loss: 6.0257 - val_root_mean_squared_error: 15.4292 - val_msle: 0.0340
Epoch 100/100
20/20 [==============================] - 5s 274ms/step - loss: 3.0558 - root_mean_squared_error: 8.0026 - msle: 0.0230 - val_loss: 5.9513 - val_root_mean_squared_error: 15.4306 - val_msle: 0.0371
</code></pre></div></div>
<p>Losses are relatively low, as is our Mean Squared Logistic Error, on both the training and validation data. Once the model was fitted, we saved the weights and used them to predict the <code class="language-text highlighter-rouge">energy</code>, <code class="language-text highlighter-rouge">valence</code>, <code class="language-text highlighter-rouge">tempo</code>, and <code class="language-text highlighter-rouge">liveness</code> of our given movie scenes.</p>

<h3 id="finding-song-matches">Finding Song Matches</h3>

<p>Now that we have metrics for both our songs and screenplays, we must develop some sort of way to determine which songs are most similar to which scenes. We can do this by computing the norm between the metrics of each song to a selected movie scene, which is essentially the distance between two points in $ n $ dimensional space.</p>

<p>First, we take the user’s top 20 songs. An random offset is applied to generate a unique list of songs each time the user uses the web app, but this list will not include any songs above their top 70 most listend to tracks. We then run our model on the song lyrics to generate the predicted metrics corresponding to the subject of the song. Though the songs already contain Spotify metrics, we wanted to use metrics generated by the lyrics of the text, as to match the subject of a song to the subject of a movie scene, rather than match the musicality of a song to a movie scene.</p>

<h2 id="what-could-have-gone-better">What could have gone better</h2>

<p>Even though the vibes were good on the team, we were honestly quite frustrated when we found our original model was pretty bad at predictions. I’m still happy that we actually managed to make that notebook that clearly diagnosed our problem and then we found a good way to change the model layers to fix it, but it was a lot more stressful than it needed to be.</p>

<p>I also still would have liked to implement the stretch goal we set for our project, being able to input your own movie scene. Indeed, we started brushing that aside after realizing how much work that would possibly take, and how quickly deadlines were approaching. Even without that piece, though, it’s still fun enough to get the recommendations for the movies we curated. To be honest, it’s something that we have ideas for if we work on this project later, like for example adding a search bar for one of those movie script databases.</p>

<p>With any kind of recommendation/curating system that lives online, there’s also always the important idea: what’s the point of this being online if it’s not going to improve with the more data it collects from users? We once again have ideas for this. We saw another group have a pretty good idea for this, in what looks to be a pretty standard way among online recommendation systems. They set up a Google form where users could submit data about when the model predicted incorrectly. We could almost definitely implement a similar system, maybe even automatically using AWS or <a href="https://databricks.com/">Databricks</a>, or some other way of running a cron job to constantly retrain the model without having to go through the extra hoop of Google form data collection. Either way, this would really be the next and maybe even final machine learning step to make this a true quality web app.</p>

<p>At the end of the day though, I think the thing to be most proud of is the website, though. As I was mentioning before, each of us has a piece of it that we’re all really happy with. At least for me personally, I’m really happy that I both found a good interesting niche to explore and develop, orchestrate the development in our little team, and make a really nice-looking and functioning website that can live online for anyone to try out.</p>

<h2 id="going-forward">Going forward</h2>

<p>That being said though, of course I want to reiterate that I’m really happy with how this project went, and no doubt that just having a project like this to show off (especially with how nice it is) will be nice to show off to potential employers. Considering my most likely post-graduation target is indeed to get some job related to data and programming, this would probably look pretty nice.</p>

<p>As I’ve mentioned before, rather than helping to teaching me lots of <em>new</em> things, I think the main “help” for my future careers or studies (who the heck knows which one is coming) has actually again been in solidifying thoughts that have been popping up in my head over the last couple years.</p>

<blockquote class="lead">
  <p>Machine learning isn’t for me</p>
</blockquote>

<p><em>What?!?! An applied math person that <strong>doesn’t</strong> like machine learning??</em> Yeah, I said it. I think I’m getting better at explaining why, but I think it has to do something with the fact that the problems I like solving (like the ones from my personal projects and stuff) don’t really have to do with predictions or dealing with missing information, so I don’t see as much appeal in teaching computer how to do that. Nonetheless, I’m still glad for the exposure because this is probably the most involved machine learning project I’ve ever taken part in, and to be honest, using it in this more “just-for-fun” scenario was actually pretty neat if anything just to see what the computer could think of. Also I suppose machine learning project looks nice on a resume :)</p>

<blockquote class="lead">
  <p>but structures and databases and organization <em>are</em> for me</p>
</blockquote>

<p>You probably got the idea from what I’ve been talking about previously, but yes. It’s funny that I come away with this conclusion as this class has unquestionably been of the very standard data science + machine learning oriented variety, but maybe all the exposure actually once again showed me why I don’t like it.</p>

<p>But yes, this project in particular was very satisfying to structure and organize. Even small things like realizing that Flask allows you to split your normally ginormous <code class="language-text highlighter-rouge">app.py</code> file into smaller “blueprints” was really satisfying, and allowed our source code to be a lot more organized and probably even professional (most professional Flask apps almost definitely do this).</p>

<p>And of course, my database solution to the whole issue of rerunning our model on all of the user’s songs every single time we changed movies was really satisfying to me as well. It might sound strange, but I had fun thinking coming up with ideas for problems like “how do I account for the user having different songs when they log in later”. I’m mentioned this sentiment a bit before in the <a href="https://mting314.github.io/blog/blog/programming/2020-05-27-ok-zoomer/">Chrome Extension</a> and <a href="https://mting314.github.io/blog/blog/programming/2020-05-27-discord-bot/">Discord bot</a>, but I seem to have a good amount of fun when thinking in this way about designing the how the technology should interface with the user’s inputs and traversal of the site.</p>

<p>And finally, one concept that kept appearing over and over again:</p>

<blockquote>
  <p>Writing good organized code</p>
</blockquote>

<p>By far the biggest frustration I had in the development process was how . And I really did let this get to me, I was mostly bothered by the fact that I was probably appearing incompetent to my teammates who basically couldn’t get access to running the project locally a large amount of the time. And I’ll be honest, we were having these problems pretty much up until the very end of the project. It’s a weakness I’ve known myself to have, not being able to deal very well with But over the course of working, I know I’ve become a lot more patient with these issues and am now much better at not getting super frustrated when this happens.</p>

<h2 id="concluding-thoughts">Concluding thoughts</h2>

<p>Overall though, I had a great time with this project, especially working with my teammates. We’re proud of what we managed to get done, yet there’s still a good amount of room for improvement. I really appreciate the opportunity to work on a real, hands-on project at UCLA where to be honest there’s so much… “book-learning”. Everyone else’s projects were pretty great (I’ll update with a link to their repositories if I can find them), but PIC 16B was a pretty great class just for the projects alone. I’m glad that we’re now able to see UCLA’s education in Python is growing, and I certainly hope for the sake of everyone that comes after me that it grows even more.</p>

  
</article>






<hr class="dingbat related" />




  
     


  <aside class="about related mt4 mb4" role="complementary">
    
    

<div class="author mt4">
  

  
    





<img
  
    src="/assets/icons/icon.jpg"
    srcset="/assets/icons/icon.jpg 1x,/assets/icons/icon.jpg 2x"
    
  
  alt="Michael Ting"
  class="avatar"
  
  width="120"
  height="120"
  loading="lazy"
/>

  

  
  
  <h2  class="page-title hr-bottom">
    About
  </h2>

  <p>Michael is an Applied Math student at UCLA, but also minoring in Statistics and Asian Languages, with a specialization in computing - just studying anything that seems fun to me. Hoping that one day he’ll able to apply all the math+programming he’s been enjoying working on to help people solve their real-world problems. But most importantly? “I can only use SpeedChat”.</p>


  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/mting314" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:giaga7@gmail.com" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://play.spotify.com/user/12162364462" title="Spotify" class="no-mark-external">
      <span class="icon-spotify"></span>
      <span class="sr-only">Spotify</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://www.linkedin.com/in/michael-ting314" title="LinkedIn" class="no-mark-external">
      <span class="icon-linkedin2"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>

  </aside>


  

  
    


  

  
    


  <aside class="other-projects related mb0" role="complementary">  <h2>Related Posts</h2>  <div class="columns">          <div class="column column-1-2">                  <article class="project-card">  <a href="/blog/blog/programming/2021-08-05-online-grade-distributions/" class="no-hover no-print-link flip-project" tabindex="-1">    <div class="project-card-img aspect-ratio sixteen-nine flip-project-img">              <img      src="/assets/img/blog/grades_files/thumbnail.PNG"        sizes="(min-width: 86em) 31.5rem, (min-width: 54em) 26.5rem, (min-width: 42em) 23.5rem, 48rem"    alt="How Grade Distributions Changed During Online Learning"      width="864"  height="486"  loading="lazy"/>          </div>  </a>  <h3 class="project-card-title flip-project-title">    <a href="/blog/blog/programming/2021-08-05-online-grade-distributions/" class="flip-title">How Grade Distributions Changed During Online Learning</a>  </h3>      <p class="project-card-text fine" property="disambiguatingDescription">      The COVID-19 pandemic changed routines in regard to learning and teaching. How did those changes impact grade distributions?    </p>      <a class="fill-card no-hover" href="/blog/blog/programming/2021-08-05-online-grade-distributions/" tabindex="-1"><span class="sr-only">Continue reading How Grade Distributions Changed During Online Learning</span></a></article>              </div>          <div class="column column-1-2">                  <article class="project-card">  <a href="/blog/blog/programming/2021-08-01-pubg/" class="no-hover no-print-link flip-project" tabindex="-1">    <div class="project-card-img aspect-ratio sixteen-nine flip-project-img">              <img      src="/assets/img/projects/pubg_thumbnail.jpg"        sizes="(min-width: 86em) 31.5rem, (min-width: 54em) 26.5rem, (min-width: 42em) 23.5rem, 48rem"    alt="PUBG Data Analysis"      width="864"  height="486"  loading="lazy"/>          </div>  </a>  <h3 class="project-card-title flip-project-title">    <a href="/blog/blog/programming/2021-08-01-pubg/" class="flip-title">PUBG Data Analysis</a>  </h3>      <p class="project-card-text fine" property="disambiguatingDescription">      Map of all kills across thousands of PUBG games, highlighted by the stage of the game in which the kill occurred.    </p>      <a class="fill-card no-hover" href="/blog/blog/programming/2021-08-01-pubg/" tabindex="-1"><span class="sr-only">Continue reading PUBG Data Analysis</span></a></article>              </div>      </div></aside>

  

  
    


  <aside class="related mb4" role="complementary">  <h2 class="hr-bottom">Random Posts</h2>  <ul class="related-posts">          <li class="h4">  <a href="/blog/blog/programming/2021-06-21-ALS_Explanation/" class="flip-title"><span>An Anime Recommendation Website! Part 2: ALS From Scratch</span></a>  <time class="faded fine" datetime="2021-06-21T00:00:00-07:00">21 Jun 2021</time></li>          <li class="h4">  <a href="/blog/blog/math/2020-08-20-The-Damped-Driven-Pendulum/" class="flip-title"><span>The Damped Driven Pendulum</span></a>  <time class="faded fine" datetime="2020-08-20T00:00:00-07:00">20 Aug 2020</time></li>          <li class="h4">  <a href="/blog/blog/programming/pic16b/2021-03-29-hw0/" class="flip-title"><span>Homework 0: Penguins</span></a>  <time class="faded fine" datetime="2021-03-29T00:00:00-07:00">29 Mar 2021</time></li>      </ul></aside>

  

  
    

  


  
<footer class="content" role="contentinfo">
  <hr/>
  
    <p><small class="copyright">Michael Ting © 2021. All rights reserved
</small></p>
  
  
    <nav class="legal"><small>
    
      
      <a class="heading flip-title" href="/LICENSE/">LICENSE</a>
      |
    
      
      <a class="heading flip-title" href="/NOTICE/">NOTICE</a>
      |
    
      
      <a class="heading flip-title" href="/CHANGELOG/">CHANGELOG</a>
      
    
    </small></nav>
  
  
    <p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">9.0.3</span></small></p>
  
  <hr class="sr-only"/>
</footer>


</main>

  <hy-drawer
  id="_drawer"
  class=""
  side="left"
  threshold="10"
  noscroll
  
>
  <header id="_sidebar" class="sidebar" role="banner">
    






<div class="sidebar-bg " style="background:linear-gradient(202deg, rgb(6 8 29) 13%, rgb(181 181 181) 87%)">

 </div>

    <div class="sidebar-sticky">
  <div class="sidebar-about">
    
      <a class="no-hover" href="/" tabindex="-1">
        <img src="/assets/icons/icon.jpg" class="avatar" alt="Michael Ting" width="120" height="120" loading="lazy" />
      </a>
    
    <a class="sidebar-title" href="/"><h2 class="h1">Michael Ting</h2>
        
      
      <h3 class="faded"> SpeedChat Enjoyer </h3>
    
    </a>
    

    
      <p class="">
        Undergraduate Student in Applied Mathematics at UCLA

      </p>
    
  </div>

  <nav class="sidebar-nav heading" role="navigation">
    <span class="sr-only">Navigation:</span>
<ul>
  
    
      
      <li>
        <a
          id="_drawer--opened"
          href="/about"
          class="sidebar-nav-item"
          
        >
          About
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/blog"
          class="sidebar-nav-item"
          
        >
          Blog
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/resume/"
          class="sidebar-nav-item"
          
        >
          Résumé\CV
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/projects/"
          class="sidebar-nav-item"
          
        >
          Projects
        </a>
      </li>
    
  
</ul>

  </nav>

  
  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/mting314" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:giaga7@gmail.com" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://play.spotify.com/user/12162364462" title="Spotify" class="no-mark-external">
      <span class="icon-spotify"></span>
      <span class="sr-only">Spotify</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://www.linkedin.com/in/michael-ting314" title="LinkedIn" class="no-mark-external">
      <span class="icon-linkedin2"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>
  </header>
</hy-drawer>
<hr class="sr-only" hidden />

</hy-push-state>


  <!--[if gt IE 10]><!---->
  <script nomodule>!function(){var e=document.createElement("script");if(!("noModule"in e)&&"onbeforeload"in e){var t=!1;document.addEventListener("beforeload",function(n){if(n.target===e)t=!0;else if(!n.target.hasAttribute("nomodule")||!t)return;n.preventDefault()},!0),e.type="module",e.src=".",document.head.appendChild(e),e.remove()}}();
</script>
  <script src="/assets/js/hydejack-9.0.3.js" type="module"></script>
  <script src="/assets/js/LEGACY-hydejack-9.0.3.js" nomodule defer></script>
  <!-- I gotta add this here or the javascript will NOT load when dynamic page reloading is disabled
typewriter.js and the code below are not that big so it should not be much of an issue in page loading speed. Especially with jekyll -->

<script src="/assets/mting314/js/jquery-3.5.1.min.js"></script>
<script src="/assets/mting314/js/typewriter.js"></script>
<script src="/assets/mting314/js/particles.min.js"></script> 
<script>
function appendLeadingZeroes(n){
    if(n <= 9){
      return "0" + n;
    };
    return n;
  };
  function strip(html){
    var doc = new DOMParser().parseFromString(html, 'text/html');
    return doc.body.textContent || "";
  };

  function getRandomSubarray(arr, size) {
    var shuffled = arr.slice(0), i = arr.length, temp, index;
    while (i--) {
        index = Math.floor((i + 1) * Math.random());
        temp = shuffled[index];
        shuffled[index] = shuffled[i];
        shuffled[i] = temp;
    }
    return shuffled.slice(0, size);
}

var blogTyperStarted = false;
var startBlogTyper = function(typingWindow){
  blogTyperStarted = true;
  var typingWindow = document.getElementsByClassName('typing-window blog')[0];  

  if(!typingWindow){
    return;
  };
  var typingWindowWrapper = document.getElementsByClassName('typing-window-wrapper')[0];  
  var app = typingWindow.getElementsByClassName('typing-area')[0];
  var closeBtn =  typingWindow.getElementsByClassName('typing-toolbar-btn close')[0];
  typingWindowWrapper.addEventListener('transitionend', function(event) {
    if(event.target !== event.currentTarget)
      return;
      /* Javascript returns max-height as a string "opx" */
    if (event.propertyName === "max-height" && typingWindowWrapper.style.maxHeight === "0px"){
      typingWindowWrapper.remove();
    }else if(event.propertyName === "opacity" && typingWindowWrapper.style.opacity < 0.1){
      typingWindowWrapper.style.maxHeight = 0;
    };
 });

  setTimeout (function() {
    closeBtn.classList.toggle('disabled');
    closeBtn.onclick = function() {
          typewriter.stop();
          typingWindowWrapper.style.opacity = 0.01;
      };
  }, 10000);
  console.log("Starting blog typer!");



  var totalLoops = 20;
  // var wordList = ["<em>PhD Student</em> 📚", "Programmer 💻", "Photographer 📷", "Pizza Lover 🍕", "Gamer 👾", "Swimmer 🏊", "Traveller 🌏"];
  const jsonData = {
        "10": "Oh, well.",
        "20": "Why not?",
        "30": "Naturally!",
        "40": "That's the way to do it.",
        "50": "Right on!",
        "60": "What up?",
        "70": "But of course!",
        "80": "Bingo!",
        "90": "You've got to be kidding...",
        "100": "Sounds good to me.",
        "110": "That's kooky!",
        "120": "Awesome!",
        "130": "For crying out loud!",
        "140": "Don't worry.",
        "150": "Grrrr!",
        "160": "What's new?",
        "170": "Hey, hey, hey!",
        "180": "See you tomorrow.",
        "190": "See you next time.",
        "200": "See ya later, alligator.",
        "210": "After a while, crocodile.",
        "220": "I need to go soon.",
        "230": "I don't know about this!",
        "240": "You're outta here!",
        "250": "Ouch, that really smarts!",
        "260": "Gotcha!",
        "270": "Please!",
        "280": "Thanks a million!",
        "290": "You are stylin'!",
        "300": "Excuse me!",
        "310": "Can I help you?",
        "320": "That's what I'm talking about!",
        "330": "If you can't take the heat, stay out of the kitchen.",
        "340": "Well shiver me timbers!",
        "350": "Well isn't that special!",
        "360": "Quit horsing around!",
        "370": "Cat got your tongue?",
        "380": "You're in the dog house now!",
        "390": "Look what the cat dragged in.",
        "400": "I need to go see a Toon.",
        "410": "Don't have a cow!",
        "420": "Don't chicken out!",
        "430": "You're a sitting duck.",
        "440": "Whatever!",
        "450": "Totally!",
        "460": "Sweet!",
        "470": "That rules!",
        "480": "Yeah, baby!",
        "490": "Catch me if you can!",
        "500": "You need to heal first.",
        "510": "You need more Laff Points.",
        "520": "I'll be back in a minute.",
        "530": "I'm hungry.",
        "540": "Yeah, right!",
        "550": "I'm sleepy.",
        "560": "I'm ready!",
        "570": "I'm bored.",
        "580": "I love it!",
        "590": "That was exciting!",
        "600": "Jump!",
        "610": "Got gags?",
        "620": "What's wrong?",
        "630": "Easy does it.",
        "640": "Slow and steady wins the race.",
        "650": "Touchdown!",
        "660": "Ready?",
        "670": "Set!",
        "680": "Go!",
        "690": "Let's go this way!",
        "700": "You won!",
        "710": "I vote yes.",
        "720": "I vote no.",
        "730": "Count me in.",
        "740": "Count me out.",
        "750": "Stay here, I'll be back.",
        "760": "That was quick!",
        "770": "Did you see that?",
        "780": "What's that smell?",
        "790": "That stinks!",
        "800": "I don't care.",
        "810": "Just what the doctor ordered.",
        "820": "Let's get this party started!",
        "830": "This way everybody!",
        "840": "What in the world?",
        "850": "The check's in the mail.",
        "860": "I heard that!",
        "870": "Are you talking to me?",
        "880": "Thank you, I'll be here all week.",
        "890": "Hmm.",
        "900": "I'll get this one.",
        "910": "I got it!",
        "920": "It's mine!",
        "930": "Please, take it.",
        "940": "Stand back, this could be dangerous.",
        "950": "No worries!",
        "960": "Oh, my!",
        "970": "Whew!",
        "980": "Owoooo!",
        "990": "All Aboard!",
        "1000": "Hot Diggity Dog!",
        "1010": "Curiosity killed the cat.",
        "2000": "Act your age!",
        "2010": "Am I glad to see you!",
        "2020": "Be my guest.",
        "2030": "Been keeping out of trouble?",
        "2040": "Better late than never!",
        "2050": "Bravo!",
        "2060": "But seriously, folks...",
        "2070": "Care to join us?",
        "2080": "Catch you later!",
        "2090": "Changed your mind?",
        "2100": "Come and get it!",
        "2110": "Dear me!",
        "2120": "Delighted to make your acquaintance.",
        "2130": "Don't do anything I wouldn't do!",
        "2140": "Don't even think about it!",
        "2150": "Don't give up the ship!",
        "2160": "Don't hold your breath.",
        "2170": "Don't ask.",
        "2180": "Easy for you to say.",
        "2190": "Enough is enough!",
        "2200": "Excellent!",
        "2210": "Fancy meeting you here!",
        "2220": "Give me a break.",
        "2230": "Glad to hear it.",
        "2240": "Go ahead, make my day!",
        "2250": "Go for it!",
        "2260": "Good job!",
        "2270": "Good to see you!",
        "2280": "Got to get moving.",
        "2290": "Got to hit the road.",
        "2300": "Hang in there.",
        "2310": "Hang on a second.",
        "2320": "Have a ball!",
        "2330": "Have fun!",
        "2340": "Haven't got all day!",
        "2350": "Hold your horses!",
        "2360": "Horsefeathers!",
        "2370": "I don't believe this!",
        "2380": "I doubt it.",
        "2390": "I owe you one.",
        "2400": "I read you loud and clear.",
        "2410": "I think so.",
        "2420": "I think you should pass.",
        "2430": "I wish I'd said that.",
        "2440": "I wouldn't if I were you.",
        "2450": "I'd be happy to!",
        "2460": "I'm helping my friend.",
        "2470": "I'm here all week.",
        "2480": "Imagine that!",
        "2490": "In the nick of time...",
        "2500": "It's not over 'til it's over.",
        "2510": "Just thinking out loud.",
        "2520": "Keep in touch.",
        "2530": "Lovely weather for ducks!",
        "2540": "Make it snappy!",
        "2550": "Make yourself at home.",
        "2560": "Maybe some other time.",
        "2570": "Mind if I join you?",
        "2580": "Nice place you have here.",
        "2590": "Nice talking to you.",
        "2600": "No doubt about it.",
        "2610": "No kidding!",
        "2620": "Not by a long shot.",
        "2630": "Of all the nerve!",
        "2640": "Okay by me.",
        "2650": "Righto.",
        "2660": "Say cheese!",
        "2670": "Say what?",
        "2680": "Tah-dah!",
        "2690": "Take it easy.",
        "2700": "Ta-ta for now!",
        "2710": "Thanks, but no thanks.",
        "2720": "That takes the cake!",
        "2730": "That's funny.",
        "2740": "That's the ticket!",
        "2750": "There's a Cog invasion!",
        "2760": "Toodles.",
        "2770": "Watch out!",
        "2780": "Well done!",
        "2790": "What's cooking?",
        "2800": "What's happening?",
        "2810": "Works for me.",
        "2820": "Yes sirree.",
        "2830": "You betcha.",
        "2840": "You do the math.",
        "2850": "You leaving so soon?",
        "2860": "You make me laugh!",
        "2870": "You take right.",
        "2880": "You're going down!",
        "3000": "Anything you say.",
        "3010": "Care if I join you?",
        "3020": "Check, please.",
        "3030": "Don't be too sure.",
        "3040": "Don't mind if I do.",
        "3050": "Don't sweat it!",
        "3060": "Don't you know it!",
        "3070": "Don't mind me.",
        "3080": "Eureka!",
        "3090": "Fancy that!",
        "3100": "Forget about it!",
        "3110": "Going my way?",
        "3120": "Good for you!",
        "3130": "Good grief.",
        "3140": "Have a good one!",
        "3150": "Heads up!",
        "3160": "Here we go again.",
        "3170": "How about that!",
        "3180": "How do you like that?",
        "3190": "I believe so.",
        "3200": "I think not.",
        "3210": "I'll get back to you.",
        "3220": "I'm all ears.",
        "3230": "I'm busy.",
        "3240": "I'm not kidding!",
        "3250": "I'm speechless.",
        "3260": "Keep smiling.",
        "3270": "Let me know!",
        "3280": "Let the pie fly!",
        "3290": "Likewise, I'm sure.",
        "3300": "Look alive!",
        "3310": "My, how time flies.",
        "3320": "No comment.",
        "3330": "Now you're talking!",
        "3340": "Okay by me.",
        "3350": "Pleased to meet you.",
        "3360": "Righto.",
        "3370": "Sure thing.",
        "3380": "Thanks a million.",
        "3390": "That's more like it.",
        "3400": "That's the stuff!",
        "3410": "Time for me to hit the hay.",
        "3420": "Trust me!",
        "3430": "Until next time.",
        "3440": "Wait up!",
        "3450": "Way to go!",
        "3460": "What brings you here?",
        "3470": "What happened?",
        "3480": "What now?",
        "3490": "You first.",
        "3500": "You take left.",
        "3510": "You wish!",
        "3520": "You're toast!",
        "3530": "You're too much!",
        "4000": "Toons rule!",
        "4010": "Cogs drool!",
        "4020": "Toons of the world unite!",
        "4030": "Howdy, partner!",
        "4040": "Much obliged.",
        "4050": "Get along, little doggie.",
        "4060": "I'm going to hit the hay.",
        "4070": "I'm chomping at the bit!",
        "4080": "This town isn't big enough for the two of us!",
        "4090": "Saddle up!",
        "4100": "Draw!!!",
        "4110": "There's gold in them there hills!",
        "4120": "Happy trails!",
        "4130": "This is where I ride off into the sunset...",
        "4140": "Let's skedaddle!",
        "4150": "You got a bee in your bonnet?",
        "4160": "Lands sake!",
        "4170": "Right as rain.",
        "4180": "I reckon so.",
        "4190": "Let's ride!",
        "4200": "Well, go figure!",
        "4210": "I'm back in the saddle again!",
        "4220": "Round up the usual suspects.",
        "4230": "Giddyup!",
        "4240": "Reach for the sky.",
        "4250": "I'm fixing to.",
        "4260": "Hold your horses!",
        "4270": "I can't hit the broad side of a barn.",
        "4280": "Y'all come back now.",
        "4290": "It's a real barn burner!",
        "4300": "Don't be a yellow belly.",
        "4310": "Feeling lucky?",
        "4320": "What in Sam Hill's goin' on here?",
        "4330": "Shake your tail feathers!",
        "4340": "Well, don't that take all.",
        "4350": "That's a sight for sore eyes!",
        "4360": "Pickins is mighty slim around here.",
        "4370": "Take a load off.",
        "4380": "Aren't you a sight!",
        "4390": "That'll learn ya!",
        "6000": "I want candy!",
        "6010": "I've got a sweet tooth.",
        "6020": "That's half-baked.",
        "6030": "Just like taking candy from a baby!",
        "6040": "They're cheaper by the dozen.",
        "6050": "Let them eat cake!",
        "6060": "That's the icing on the cake.",
        "6070": "You can't have your cake and eat it too.",
        "6080": "I feel like a kid in a candy store.",
        "6090": "Six of one, half a dozen of the other...",
        "6100": "Let's keep it short and sweet.",
        "6110": "Keep your eye on the doughnut not the hole.",
        "6120": "That's pie in the sky.",
        "6130": "But it's wafer thin.",
        "6140": "Let's gum up the works!",
        "6150": "You're one tough cookie!",
        "6160": "That's the way the cookie crumbles.",
        "6170": "Like water for chocolate.",
        "6180": "Are you trying to sweet talk me?",
        "6190": "A spoonful of sugar helps the medicine go down.",
        "6200": "You are what you eat!",
        "6210": "Easy as pie!",
        "6220": "Don't be a sucker!",
        "6230": "Sugar and spice and everything nice.",
        "6240": "It's like butter!",
        "6250": "The candyman can!",
        "6260": "We all scream for ice cream!",
        "6270": "Let's not sugar coat it.",
        "6280": "Knock knock...",
        "6290": "Who's there?",
        "7000": "Quit monkeying around!",
        "7010": "That really throws a monkey-wrench in things.",
        "7020": "Monkey see, monkey do.",
        "7030": "They made a monkey out of you.",
        "7040": "That sounds like monkey business.",
        "7050": "I'm just monkeying with you.",
        "7060": "Who's gonna be monkey in the middle?",
        "7070": "That's a monkey off my back...",
        "7080": "This is more fun than a barrel of monkeys!",
        "7090": "Well I'll be a monkey's uncle.",
        "7100": "I've got monkeys on the brain.",
        "7110": "What's with the monkey suit?",
        "7120": "Hear no evil.",
        "7130": "See no evil.",
        "7140": "Speak no evil.",
        "7150": "Let's make like a banana and split.",
        "7160": "It's a jungle out there.",
        "7170": "You're the top banana.",
        "7180": "Cool bananas!",
        "7190": "I'm going bananas!",
        "7200": "Let's get into the swing of things!",
        "7210": "This place is swinging!",
        "7220": "I'm dying on the vine.",
        "7230": "Let's make like a tree and leave.",
        "7240": "Jellybeans don't grow on trees!",
        "10000": "This place is a ghost town.",
        "10001": "Nice costume!",
        "10002": "I think this place is haunted.",
        "10003": "Trick or Treat!",
        "10004": "Boo!",
        "10005": "Happy Haunting!",
        "10006": "Happy Halloween!",
        "10007": "It's time for me to turn into a pumpkin.",
        "10008": "Spooktastic!",
        "10009": "Spooky!",
        "10010": "That's creepy!",
        "10011": "I hate spiders!",
        "10012": "Did you hear that?",
        "10013": "You don't have a ghost of a chance!",
        "10014": "You scared me!",
        "10015": "That's spooky!",
        "10016": "That's freaky!",
        "10017": "That was strange....",
        "10018": "Skeletons in your closet?",
        "10019": "Did I scare you?",
        "11000": "Bah! Humbug!",
        "11001": "Better not pout!",
        "11002": "Brrr!",
        "11003": "Chill out!",
        "11004": "Come and get it!",
        "11005": "Don't be a turkey.",
        "11006": "Gobble gobble!",
        "11007": "Happy holidays!",
        "11008": "Happy New Year!",
        "11009": "Happy Thanksgiving!",
        "11010": "Happy Turkey Day!",
        "11011": "Ho! Ho! Ho!",
        "11012": "It's \"snow\" problem.",
        "11013": "It's \"snow\" wonder.",
        "11014": "Let it snow!",
        "11015": "Rake 'em in.",
        "11016": "Season's greetings!",
        "11017": "Snow doubt about it!",
        "11018": "Snow far, snow good!",
        "11019": "Yule be sorry!",
        "11020": "Have a Wonderful Winter!",
        "11021": "The Holiday Party decorations are Toontastic!",
        "11022": "Toon Troopers are hosting Holiday Parties!",
        "12000": "Be mine!",
        "12001": "Be my sweetie!",
        "12002": "Happy ValenToon's Day!",
        "12003": "Aww, how cute.",
        "12004": "I'm sweet on you.",
        "12005": "It's puppy love.",
        "12006": "Love ya!",
        "12007": "Will you be my ValenToon?",
        "12008": "You are a sweetheart.",
        "12009": "You are as sweet as pie.",
        "12010": "You are cute.",
        "12011": "You need a hug.",
        "12012": "Lovely!",
        "12013": "That's darling!",
        "12014": "Roses are red...",
        "12015": "Violets are blue...",
        "12016": "That's sweet!",
        "12050": "I LOVE busting Cogs!",
        "12051": "You're dynamite!",
        "12052": "I only have hypno-eyes for you!",
        "12053": "You're sweeter than a jellybean!",
        "12054": "I'd LOVE for you to come to my ValenToon's party!",
        "13000": "Top o' the mornin' to you!",
        "13001": "Happy St. Patrick's Day!",
        "13002": "You're not wearing green!",
        "13003": "It's the luck of the Irish.",
        "13004": "I'm green with envy.",
        "13005": "You lucky dog!",
        "13006": "You're my four leaf clover!",
        "13007": "You're my lucky charm!",
        "14000": "Let's have a summer Estate party!",
        "14001": "It's party time!",
        "14002": "Last one in the pond is a rotten Cog!",
        "14003": "Group Doodle training time!",
        "14004": "Doodle training time!",
        "14005": "Your Doodle is cool!",
        "14006": "What tricks can your Doodle do?",
        "14007": "Time for Cannon Pinball!",
        "14008": "Cannon Pinball rocks!",
        "14009": "Your Estate rocks!",
        "14010": "Your Garden is cool!",
        "14011": "Your Estate is cool!",
        "14012": "I don't have anyone to call for help",
        "14013": "I like your style.",
        "14014": "Send in a bug report"
      }
  var wordList = getRandomSubarray(Object.values(jsonData), 10);
  var pause = [1000, 4500];
  var terminalStarter = "> <span style='color: #5cd400;'> mting314@blog:</span><span style='color: #1c39c7;'>~</span>$ ";
  var current_datetime = new Date();
  var formatted_date = current_datetime.getFullYear() + "-" + appendLeadingZeroes(current_datetime.getMonth() + 1) + "-" + appendLeadingZeroes(current_datetime.getDate()) + " " + appendLeadingZeroes(current_datetime.getHours()) + ":" + appendLeadingZeroes(current_datetime.getMinutes()) + ":" + appendLeadingZeroes(current_datetime.getSeconds());

  var randomDelay = function(){
   return Math.random() * (pause[1] - pause[0] + pause[0]);
  };
  var typewriter = new Typewriter(app, {
    loop: false,
    delay: 'natural',
    cursor: '▌'
  });

  typewriter
  .pasteString(terminalStarter +"["+formatted_date+"]")
  .pauseFor(1000);

  if(current_datetime.getHours() > 22 ||current_datetime.getHours() < 5){
    typewriter
    .changeDelay(50)
    .pasteString("<br /> " +terminalStarter)
    .typeString("What are you doing up late? :)")
    .pauseFor(randomDelay());
  };

  if((current_datetime.getMonth() + 1) == 6 && current_datetime.getDate() == 9){
    typewriter
    .changeDelay(50)
    .pasteString("<br /> " +terminalStarter)
    .typeString("It's my birthday today! 🎂🎉")
    .pauseFor(randomDelay());    
  };

  console.log("aolsikfhjalskfhj");
  typewriter
  .changeDelay(90)
  .pasteString("<br /> " +terminalStarter)
  .pauseFor(1200)
  .typeString("Hey!")
  .pauseFor(800)
  .typeString(" I'm <strong>Michael</strong>")
  .pauseFor(1000)
  .pasteString("<br /> " + terminalStarter)
  .typeString(" I can only use SpeedChat.")
  .pauseFor(1000)
  .pasteString("<br /> " + terminalStarter)
  .typeString(" SpeedChat: ")
  ;

  let toType;
  for(var k = 0; k < totalLoops; k++){ 
    for(var i=0; i < wordList.length; i++){
      toType = wordList[parseInt(Math.random() * wordList.length)]
      typewriter
      .typeString(toType)
      .pauseFor(randomDelay())
      .deleteChars(strip(toType).length);
    };
  };
  typewriter.start();
};

var startTypers = function(){
  /*if(!blogTyperStarted){  startBlogTyper() }; */
  startBlogTyper();
  
};

var linesAdded = false;
var codeLinesSpan = "<span class='code-lines' style='display: none;'> </span>";
var codeLinesBtn = "<span class='code-lines-btn icon-list-numbered'></span>";
var codeLanguageTag = "<span class='code-language-tag'></span>";
var codeOutputTag = "<span class='code-output-tag icon-enlarge2'></span>";
var codeOutputMinHeight = "3rem";
var codeExtrasSpan = "<span class='code-extras'></span>";
var charLength = 0.8+0.1;
var addCodeLines = function(){
  console.log(linesAdded);
  if(linesAdded){
    return;
  }
  linesAdded = true;
  $(".highlight").each(function(index){
    if($(this).find(".code-lines").length > 0){
      return;
    };
    if($(this).parents(".highlight").length > 0){ /*We only want the most external one */
      return;
    };
    var code = $(this).find("code");
    var languageClass = code.attr('class');
    if(!languageClass){
      languageClass = $($(this).parents(".highlighter-rouge")[0]).attr('class');
    };
    var language = languageClass.split("-")[1].split(" ")[0].trim();
    var codeExtras = $(codeExtrasSpan);
      var languageTag = $(codeLanguageTag);
    if(language === 'plaintext'){
      languageTag.text("output");
      codeExtras.prepend(languageTag);
      $(this).addClass("code-output");
      var outputTag = $(codeOutputTag);
      code.parent().css("max-height", codeOutputMinHeight);
      outputTag.click(function(){
          var par = $(this).parent().parent();
          par.toggleClass("expanded");
        if( $(this).hasClass("enabled")){
          par.find("code").parent().css('max-height', codeOutputMinHeight);
        }
        else{   
          par.find("code").parent().css('max-height', '');
        };
        $(this).toggleClass("enabled");
      });
      codeExtras.prepend(outputTag);    
    }
    else{
      languageTag.text(language);
      codeExtras.prepend(languageTag);
      var noLines = code.text().trim().split(/\r\n|\r|\n/).length;
      if(noLines > 5){
        var linesSpan = $(codeLinesSpan);
        linesSpan.attr("code-lines", noLines);
        var linesBtnSpan = $(codeLinesBtn);
        linesBtnSpan.click(function(){
          if( $(this).hasClass("enabled")){
            var par = $(this).parent().parent();
            var codeLines = par.find(".code-lines");
            par.find("code").parent().css("padding-left", "");
            codeLines.css('opacity', '0');
            codeLines.css('display', 'none');
          }
          else{   
            var par = $(this).parent().parent();
            var codeLines = par.find(".code-lines");
            var padding = Math.max(2,codeLines.attr("code-lines").length)+"rem";
            par.find("code").parent().css("padding-left", padding);
            codeLines.css('display', '');
            codeLines.css('opacity', '1');
          };
          $(this).toggleClass("enabled");
        });
        linesSpan.text([...Array(noLines).keys()].join("\n"));
        $(this).prepend(linesSpan);
        codeExtras.prepend(linesBtnSpan);
      };
    };
    $(this).prepend(codeExtras);
    $(this).addClass("code-extended");
  });
};


document.getElementById('_pushState').addEventListener('hy-push-state-load', function() {
    startTypers();
    addCodeLines();
});


document.getElementById('_pushState').addEventListener('hy-push-state-start', function() {
  linesAdded = false;
});
document.addEventListener('DOMContentLoaded', function(){ 
    startTypers();
}, false);
</script>
  
  <script>!function(w, d) {
    w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;

    /**/
      ga('create', 'UA-145580315-1', 'auto');
    /**/

    var pushStateEl = d.getElementById('_pushState');
    var timeoutId;
    pushStateEl.addEventListener('hy-push-state-load', function() {
      w.clearTimeout(timeoutId);
      timeoutId = w.setTimeout(function() {
        ga('set', 'page', w.location.pathname);
        ga('send', 'pageview');
      }, 500);
    });

    d.addEventListener('hy--cookies-ok', function () {
      w.ga(function(tracker) {
        w.ga("set", "anonymizeIp", undefined);
        localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId"));
      });
    });

    w.loadJSDeferred('https://www.google-analytics.com/analytics.js');
  }(window, document);</script>


  <script type="module">
    if ('serviceWorker' in navigator) {
      /**/
      navigator.serviceWorker.register('/sw.js')
        .then(r => r.update())
        .catch(() => {});
      /**/
    }
  </script>
<!--<![endif]-->
  <!-- <script>
  document.querySelector('hy-push-state').setAttribute('prefetch', '');

  document.querySelectorAll('.sidebar a[href^="/"]').forEach(function (el) { 
    el.addEventListener('click', function (e) {
      if (el.pathname === window.location.pathname) {
        e.preventDefault();
        e.stopPropagation();
        document.querySelector('hy-drawer').close();
      }
    });
  });
</script> -->

<!--
Code for integrating CloudFlare's email protection with Hydejack's single page app loading.
-->
<script>
  document.getElementById('_pushState').addEventListener('hy-push-state-after', function (e) {
    function e(e){
      (console.error?console.error:console.log).call(console,e)
    }

    function t(e){
      return l.innerHTML='<a href="'+e.replace(/"/g,"&quot;")+'"></a>',l.childNodes[0].getAttribute("href")
    }

    function r(e,t){
      var r=e.substr(t,2);return parseInt(r,16)
    }

    function n(e,n){
      for(var o="",c=r(e,n),a=n+2;a<e.length;a+=2){
        var l=r(e,a)^c;
        o+=String.fromCharCode(l)
      }
      return t(o)
    }

    var o="/cdn-cgi/l/email-protection#",
        c=".__cf_email__",
        a="data-cfemail",
        l=document.createElement("div");

    !function(){
      for(var t=document.getElementsByTagName("a"),r=0;r<t.length;r++)
        try{
          var c=t[r],a=c.href.indexOf(o);
          a>-1&&(c.href="mailto:"+n(c.href,a+o.length))
        }catch(t){
          e(t)
        }
    }(),
    function(){
      for(var t=document.querySelectorAll(c),r=0;r<t.length;r++)
        try{
          var o=t[r],l=n(o.getAttribute(a),0),i=document.createTextNode(l);
          o.parentNode.replaceChild(i,o)
        }catch(t){
          e(t)
        }
    }()
  });
</script>





<div hidden>
  
  <h2 class="sr-only">Templates (for web app):</h2>

  <template id="_animation-template">
  <div class="animation-main fixed-top">
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

  <template id="_loading-template">
  <div class="loading nav-btn fr">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

  <template id="_error-template">
  <div class="page">
    <h1 class="page-title">Error</h1>
    
    
    <p class="lead">
      Sorry, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

  <template id="_forward-template">
  <button id="_forward" class="forward nav-btn no-hover">
    <span class="sr-only">Forward</span>
    <span class="icon-arrow-right2"></span>
  </button>
</template>

  <template id="_back-template">
  <button id="_back" class="back nav-btn no-hover">
    <span class="sr-only">Back</span>
    <span class="icon-arrow-left2"></span>
  </button>
</template>

  <template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="content-hash"></span>
  </a>
</template>

  
  
    <template id="_dark-mode-template">
  <button id="_dark-mode" class="nav-btn no-hover" >
    <span class="sr-only">Dark Mode</span>
    <span class="icon-brightness-contrast"></span>
  </button>
</template>

  
  
    <template id="_search-template">
  <button id="_search" class="nav-btn no-hover">
    <label class="sr-only" for="_search-input">Search</label>
    <span class="icon-search"></span>
  </button>
  <div id="_search-box">
    <div class="nav-btn">
      <span class="icon-search"></span>
    </div>
    <input 
      id="_search-input"
      type="search"
      class="form-control form-control-lg nav-btn"
      placeholder="SEARCH NOT ENABLED DURING DEVELOPMENT"
    />
    <button type="reset" class="nav-btn no-hover">
      <span class="sr-only">Close</span>
      <span class="icon-cross"></span>
    </button>
  </div>
  <div id="_hits"></div>
</template>

  
</div>

</body>
</html>
